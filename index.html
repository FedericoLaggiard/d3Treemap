<!DOCTYPE html>
<html>
<head lang="it">
    <meta charset="UTF-8">
    <title>TEST D3 TREEMAP</title>
</head>
<body>

<div id="treemap">

</div>

<script src="assets/underscore/underscore.js" type="text/javascript"></script>
<script src="assets/jquery/jquery-2.1.1.min.js" type="text/javascript"></script>
<script src="assets/D3/d3.js" type="text/javascript"></script>
<script src="assets/D3/d3.layout.js" type="text/javascript"></script>


<!--<script src="treemap.js" type="text/javascript"></script>-->
<script src="zoomTreemap.js" type="text/javascript"></script>


<script type="text/javascript">

    $(document).ready(function(){

        $.get('http://54.76.107.105/MonFlussiReport/api/TreeMap/242?FieldCode=N.RECORD%20CALCOLATO&preventCache=Thu%20Oct%2016%202014%2010:51:36%20GMT+0200%20(CEST)', function(data){
        //$.get('/data/zoomDataEx.json', function(data){
            zoomTreemap.draw( parseData(data) );
            //zoomTreemap.draw( JSON.parse(data) );
        });

    });



    function parseData(data) {

        var formattedChildren = _.each(data.groups, function(item){

            item.drillDownLevel = 1;
            item.children = item.Sons;
            item.size = Math.abs(parseFloat(item.TotValue));
            item.size === 0 ? item.size = 1 : item.size;
            item.name = item.GroupDescription;
            _.each(item.children, function(child){

                child.drillDownLevel = 2;
                child.name = child.GroupDescription;
                child.size = Math.abs(parseFloat(child.TotValue));
                child.size === 0 ? child.size = 1 : child.size;
                child.children = child.Sons;
                _.each(child.children, function(childOfChild){
                    childOfChild.drillDownLevel = 3;
                    childOfChild.size = Math.abs(parseFloat(childOfChild.TotValue));
                    childOfChild.size === 0 ? childOfChild.size = 1 : childOfChild.size;
                    childOfChild.name = childOfChild.GroupDescription;
                });
            });
        });
        parsedData = {
            name: "a",
            drillDownLevel: 0,
            children: formattedChildren
        };
        return parsedData;

    }

</script>

</body>
</html>